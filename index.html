<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HomeCare Companion</title>
  <style>
    /* --- Simple mobile-first styles --- */
    :root{
      --bg1:#ffecd2; --bg2:#fcb69f; --primary:#ff9a9e; --accent:#ffa585; --surface:#ffffff;
      --muted:#999; --text:#333; --radius:18px; --ui-gap:14px;
      --touch-size:44px;
    }
    html,body{height:100%;margin:0;font-family:Quicksand,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    body{
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      padding:20px; -webkit-font-smoothing:antialiased; color:var(--text);
      display:flex; align-items:flex-start; justify-content:center;
    }
    .app {
      width:100%; max-width:420px; background:transparent;
    }
    .card{
      background:var(--surface); border-radius:24px; padding:18px; box-shadow:0 8px 24px rgba(0,0,0,0.12);
      margin-bottom:16px;
    }
    header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px;}
    .title{font-size:20px; font-weight:700; color:var(--primary);}
    .subtitle{font-size:13px; color:var(--muted);}
    .creature-wrap{display:flex; flex-direction:column; align-items:center; gap:8px;}
    /* blob svg sizes */
    .creature { width:160px; height:160px; }
    .status{font-weight:600; color:var(--primary);}
    .stats{display:flex; gap:10px; margin-top:8px;}
    .stat{flex:1; text-align:center; background:linear-gradient(180deg, rgba(255,255,255,0.8), rgba(255,255,255,0.95)); padding:10px; border-radius:14px;}
    .stat .value{font-size:18px; font-weight:700; color:var(--primary);}
    .progress-track{height:18px; background:#f0f0f0; border-radius:9px; overflow:hidden;}
    .progress-fill{height:100%; background:linear-gradient(90deg,var(--accent),var(--primary)); width:0%; display:flex; align-items:center; justify-content:center; color:white; font-weight:700; font-size:12px;}
    /* Tasks list */
    .tasks-list{display:flex; flex-direction:column; gap:8px;}
    .task-item{display:flex; align-items:center; gap:12px; padding:12px; border-radius:12px; background:linear-gradient(180deg,#fff, #fff); cursor:pointer; user-select:none; border:1px solid #f2f2f2;}
    .task-checkbox{min-width:36px; min-height:36px; width:36px; height:36px; border-radius:10px; border:2px solid #eee; display:flex; align-items:center; justify-content:center; font-weight:700; color:white;}
    .task-name{flex:1; font-weight:600;}
    .task-points{font-weight:700; color:var(--primary); font-size:13px;}
    .completed .task-name{color:#bbb; text-decoration:line-through;}
    .completed .task-checkbox{background:var(--primary); border-color:var(--primary);}
    /* bottom nav */
    .nav{display:flex; gap:8px; justify-content:space-between; margin-top:8px;}
    .nav button{flex:1; padding:10px 8px; border-radius:12px; border:none; background:transparent; font-weight:700; color:var(--muted);}
    .nav button.active{background:linear-gradient(90deg,var(--accent),var(--primary)); color:white;}
    /* customization */
    .color-grid{display:grid; grid-template-columns:repeat(4,1fr); gap:8px;}
    .color-swatch{padding-top:100%; border-radius:12px; position:relative; cursor:pointer;}
    .color-swatch-inner{position:absolute; inset:8px; border-radius:8px;}
    .accessory-grid{display:flex; gap:8px; flex-wrap:wrap;}
    .accessory-btn{padding:10px; border-radius:12px; border:1px solid #eee; min-width:48px; text-align:center; font-size:20px;}
    .accessory-btn.locked{opacity:0.3; cursor:not-allowed;}
    /* responsive small */
    @media (max-width:420px){ body{padding:14px;} .creature{width:140px;height:140px;} }
    .small{font-size:12px;color:var(--muted);}
    .center{text-align:center;}
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="HomeCare Companion">
    <!-- Header / Home -->
    <div id="homeView" class="card" aria-hidden="false">
      <header>
        <div>
          <div class="title" id="appTitle">HomeCare Companion</div>
          <div class="subtitle" id="welcomeText">Let's make your home feel peaceful, one small task at a time.</div>
        </div>
        <div style="text-align:right">
          <div class="small">Level</div>
          <div style="font-weight:800;color:var(--primary); font-size:18px" id="levelBadge">1</div>
        </div>
      </header>

      <div class="creature-wrap card" style="padding:14px;">
        <svg class="creature" viewBox="0 0 200 200" id="creatureSVG" aria-hidden="true">
          <ellipse cx="100" cy="130" rx="45" ry="12" fill="rgba(0,0,0,0.08)"/>
          <circle cx="100" cy="90" r="70" id="blobBody" fill="#FFB6D9"/>
          <circle cx="75" cy="85" r="10" fill="#2C1810"/>
          <circle cx="125" cy="85" r="10" fill="#2C1810"/>
          <circle cx="78" cy="82" r="3" fill="#fff"/>
          <circle cx="128" cy="82" r="3" fill="#fff"/>
          <path d="M85 110 Q100 118 115 110" stroke="#2C1810" stroke-width="3" fill="none" stroke-linecap="round"/>
          <g id="accessoryLayer"></g>
        </svg>
        <div class="status" id="creatureStatus">Content &amp; Ready</div>

        <div class="stats" style="margin-top:12px;">
          <div class="stat">
            <div class="small">Today</div>
            <div class="value" id="todayCount">0/0</div>
          </div>
          <div class="stat">
            <div class="small">Points</div>
            <div class="value" id="pointsTotal">0</div>
          </div>
        </div>

        <div style="margin-top:12px; width:100%;">
          <div class="small" style="display:flex; justify-content:space-between; margin-bottom:6px;">
            <span>Daily Progress</span><span id="progressPercent">0%</span>
          </div>
          <div class="progress-track"><div class="progress-fill" id="progressFill">0%</div></div>
        </div>
      </div>
    </div>

    <!-- Tasks Screen -->
    <div id="tasksView" class="card" style="display:none;">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div>
          <div class="title">Daily Tasks</div>
          <div class="subtitle">Small tasks, big transformation.</div>
        </div>
        <div>
          <button id="regenBtn" style="border:none;background:transparent;color:var(--muted);font-weight:700;">Regenerate</button>
        </div>
      </div>

      <div style="margin-top:12px;" id="taskContainer"></div>
      <div class="small center" style="margin-top:10px;">Tasks refresh daily. Same task will not reappear for 2 days.</div>
    </div>

    <!-- Progress Screen -->
    <div id="progressView" class="card" style="display:none;">
      <div class="title">Your Progress</div>
      <div style="margin-top:10px;" class="small">Weekly & all-time statistics</div>

      <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:12px;">
        <div class="card" style="padding:12px;">
          <div class="small">This week</div>
          <div style="font-weight:800;font-size:20px;" id="weekTasks">0</div>
          <div class="small">tasks completed</div>
        </div>
        <div class="card" style="padding:12px;">
          <div class="small">All time</div>
          <div style="font-weight:800;font-size:20px;" id="allTasks">0</div>
          <div class="small">tasks completed</div>
        </div>
      </div>

      <div style="margin-top:12px;" class="card">
        <div class="small">Current Streak</div>
        <div style="font-weight:800;font-size:22px;" id="streak">0</div>
      </div>
    </div>

    <!-- Customize -->
    <div id="customizeView" class="card" style="display:none;">
      <div class="title">Customize Companion</div>
      <div class="small" style="margin-top:8px;">Pick a color</div>
      <div style="margin-top:10px;" class="color-grid" id="colorGrid"></div>

      <div style="margin-top:14px;">
        <div class="small">Accessories</div>
        <div class="accessory-grid" id="accessoryGrid"></div>
        <div class="small" style="margin-top:8px;">Accessories unlock as you level up.</div>
      </div>
    </div>

    <!-- Nav -->
    <div class="nav">
      <button id="navHome" class="active">üè† Home</button>
      <button id="navTasks">‚úì Tasks</button>
      <button id="navProgress">üìä Progress</button>
      <button id="navCustomize">üé® Customize</button>
    </div>
  </div>

  <script>
  (function(){
    // ---------- CONFIG ----------
    const TASK_POOL = [
      {name:"Make your bed", points:10},
      {name:"Wipe kitchen counters", points:10},
      {name:"Pick up clutter (5 min)", points:10},
      {name:"Sweep entryway", points:10},
      {name:"Clean bathroom sink", points:12},
      {name:"Organize one small area", points:12},
      {name:"Take out trash", points:8},
      {name:"Do dishes / load dishwasher", points:12},
      {name:"Vacuum main room", points:15},
      {name:"Wipe mirrors", points:8},
      {name:"Fold laundry (10 min)", points:12},
      {name:"Water plants", points:6},
      {name:"Declutter a drawer", points:12},
      {name:"Dust surfaces", points:10},
      {name:"Clear & wipe table", points:8},
      {name:"Wash bed sheets", points:14},
      {name:"Organize closet", points:14},
      {name:"Wash towels", points:12},
      {name:"Wash rags", points:10},
      {name:"Wash curtains", points:14},
      {name:"Clean windows", points:15},
      {name:"Clean fans", points:12},
      {name:"Organize classroom", points:14},
      {name:"Organize living room", points:12},
      {name:"Organize kids bedroom", points:14},
      {name:"Mop 2 areas", points:15},
      {name:"Clean toilet", points:12},
      {name:"Wash shower and tub", points:15}
    ];

    const LS_KEYS = {
      todayDate: 'hc_taskDate',
      todayTasks: 'hc_tasks',
      history: 'hc_history',     
      completions: 'hc_completed',
      customization: 'hc_custom'
    };

    function toISODate(d){ return new Date(d).toISOString().split('T')[0]; }

    function seedFromString(str){
      let h=2166136261>>>0;
      for(let i=0;i<str.length;i++){ h = Math.imul(h ^ str.charCodeAt(i), 16777619) >>> 0; }
      return h;
    }
    function mulberry32(a){
      return function(){ a |= 0; a = a + 0x6D2B79F5 | 0; let t = Math.imul(a ^ a >>> 15, 1 | a); t = t + Math.imul(t ^ t >>> 7, 61 | t) ^ t; return ((t ^ t >>> 14) >>> 0) / 4294967296; };
    }
    function seededShuffle(arr, seedStr){
      const seed = seedFromString(seedStr);
      const rand = mulberry32(seed);
      const copy = arr.slice();
      for (let i = copy.length - 1; i > 0; i--){
        const j = Math.floor(rand() * (i + 1));
        [copy[i], copy[j]] = [copy[j], copy[i]];
      }
      return copy;
    }
    function readJSON(key,fallback){try{ const v=localStorage.getItem(key); return v?JSON.parse(v):fallback;}catch(e){return fallback;}}
    function writeJSON(key,obj){try{localStorage.setItem(key,JSON.stringify(obj));}catch(e){}} 

    // ---------- TASK LOGIC ----------
    function loadTodayTasks(){
      const savedDate = localStorage.getItem(LS_KEYS.todayDate);
      const today = toISODate(new Date());
      if(savedDate === today) return readJSON(LS_KEYS.todayTasks, []);
      const newTasks = generateTasksForToday();
      writeJSON(LS_KEYS.todayTasks,newTasks);
      localStorage.setItem(LS_KEYS.todayDate,today);
      const hist = readJSON(LS_KEYS.history, []);
      hist.unshift({date: today, tasks: newTasks.map(t=>t.name)});
      writeJSON(LS_KEYS.history, hist.slice(0,7));
      return newTasks;
    }

    function generateTasksForToday(){
      const today = toISODate(new Date());
      const hist = readJSON(LS_KEYS.history, []);
      const avoid = new Set();
      const yesterday = new Date(); yesterday.setDate(yesterday.getDate()-1);
      const dayBefore = new Date(); dayBefore.setDate(dayBefore.getDate()-2);
      const avoidDates = [toISODate(yesterday), toISODate(dayBefore)];
      hist.forEach(entry => { if(avoidDates.includes(entry.date)){ entry.tasks.forEach(t=>avoid.add(t)); } });
      let available = TASK_POOL.filter(t => !avoid.has(t.name));
      if(available.length < 10) available = TASK_POOL.slice();
      const shuffled = seededShuffle(available, today + "_homecare_v2");
      const rand = mulberry32(seedFromString(today));
      const count = 8 + Math.floor(rand() * 3);
      const picked = [];
      const pickedNames = new Set();
      for(let t of shuffled){
        if(!pickedNames.has(t.name)){
          picked.push({id:`task_${today}_${picked.length}`, name:t.name, points:t.points||10, completed:false, createdAt:new Date().toISOString()});
          pickedNames.add(t.name);
        }
        if(picked.length>=count) break;
      }
      return picked;
    }

    function toggleComplete(taskId){
      const tasks = readJSON(LS_KEYS.todayTasks, []);
      const idx = tasks.findIndex(t=>t.id===taskId); if(idx===-1) return;
      tasks[idx].completed = !tasks[idx].completed;
      let all = readJSON(LS_KEYS.completions, []);
      const todayISO = new Date().toISOString().split('T')[0];
      if(tasks[idx].completed){ all.push({taskName: tasks[idx].name, completedAt: new Date().toISOString(), points: tasks[idx].points||10}); }
      else { for(let i=all.length-1;i>=0;i--){ if(all[i].taskName===tasks[idx].name && all[i].completedAt.split('T')[0]===todayISO){ all.splice(i,1); break; } } }
      writeJSON(LS_KEYS.completions, all);
      writeJSON(LS_KEYS.todayTasks, tasks);
      renderAll();
    }

    function calculateProgress(){
      const tasks = readJSON(LS_KEYS.todayTasks, []);
      const total = tasks.length;
      const completed = tasks.filter(t=>t.completed).length;
      const percent = total===0?0:Math.round((completed/total)*100);
      const allCompletions = readJSON(LS_KEYS.completions, []);
      const totalPoints = allCompletions.reduce((s,c)=>s+(c.points||0),0);
      const level = Math.floor(totalPoints/100)+1;
      return {total, completed, percent, totalPoints, level};
    }
    function calculateWeekStats(){
      const all = readJSON(LS_KEYS.completions, []);
      const now = new Date();
      const weekStart = new Date(now); weekStart.setDate(now.getDate()-6);
      const weekISO = weekStart.toISOString().split('T')[0];
      const week = all.filter(c=>c.completedAt.split('T')[0]>=weekISO).length;
      return {week, allTime: all.length};
    }

    // ---------- RENDER ----------
    const taskContainer = document.getElementById('taskContainer');
    function renderTasks(){
      const tasks = readJSON(LS_KEYS.todayTasks, []);
      taskContainer.innerHTML='';
      tasks.forEach(t=>{
        const div = document.createElement('div');
        div.className='task-item'+(t.completed?' completed':'');
        div.setAttribute('role','button');
        div.setAttribute('aria-pressed', t.completed?'true':'false');
        div.onclick=()=>toggleComplete(t.id);
        div.innerHTML=`<div class="task-checkbox">${t.completed?'‚úì':''}</div>
                        <div class="task-name">${t.name}</div>
                        <div class="task-points">${t.points} pts</div>`;
        taskContainer.appendChild(div);
      });
    }

    function renderAll(){
      renderTasks();
      const p = calculateProgress();
      document.getElementById('todayCount').innerText=`${p.completed}/${p.total}`;
      document.getElementById('pointsTotal').innerText=p.totalPoints;
      document.getElementById('progressPercent').innerText=p.percent+'%';
      document.getElementById('progressFill').style.width=p.percent+'%';
      document.getElementById('levelBadge').innerText=p.level;
      const ws = calculateWeekStats();
      document.getElementById('weekTasks').innerText=ws.week;
      document.getElementById('allTasks').innerText=ws.allTime;
    }

    document.getElementById('regenBtn').onclick=()=>{
      localStorage.removeItem(LS_KEYS.todayTasks);
      localStorage.removeItem(LS_KEYS.todayDate);
      loadTodayTasks();
      renderAll();
    }

    // ---------- INIT ----------
    loadTodayTasks();
    renderAll();

    // ---------- NAV ----------
    function showView(id){
      ['homeView','tasksView','progressView','customizeView'].forEach(v=>{
        document.getElementById(v).style.display=(v===id)?'block':'none';
      });
      document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));
      if(id==='homeView') document.getElementById('navHome').classList.add('active');
      if(id==='tasksView') document.getElementById('navTasks').classList.add('active');
      if(id==='progressView') document.getElementById('navProgress').classList.add('active');
      if(id==='customizeView') document.getElementById('navCustomize').classList.add('active');
    }
    document.getElementById('navHome').onclick=()=>showView('homeView');
    document.getElementById('navTasks').onclick=()=>showView('tasksView');
    document.getElementById('navProgress').onclick=()=>showView('progressView');
    document.getElementById('navCustomize').onclick=()=>showView('customizeView');

  })();
  </script>
</body>
</html>
